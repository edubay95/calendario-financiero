name: Actualizar Calendario Financiero

# --- Disparadores (Cuándo se ejecuta) ---
on:
  # 1. Un botón para ejecutarlo manualmente
  workflow_dispatch:
  
  # 2. Programación automática (6:00 AM UTC todos los días)
  schedule:
    - cron: '0 6 * * *'

# --- Tareas (Qué hace el robot) ---
jobs:
  build-calendar:
    runs-on: ubuntu-latest # Usa un servidor Linux

    permissions:
          contents: write

    steps:
      # 1. Descarga tu código (el .py, .csv, .txt)
      - name: Checkout del código
        uses: actions/checkout@v4

      # 2. Configura Python
      - name: Configurar Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10' # Usa Python 3.10

      # 3. Instala las librerías necesarias
      - name: Instalar dependencias
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install -r lxml_requirements.txt

      # 4. ¡Ejecuta tu script!
      - name: Ejecutar script de Python
        run: python generate_calendar.py

      # 5. Guarda los 3 archivos .ics nuevos en el repositorio
      - name: Commit de los archivos .ics
        uses: EndBug/add-and-commit@v9
        with:
          # El mensaje del "commit" (registro)
          message: '🤖 Auto-actualización de calendarios .ics'
          # Qué archivos debe añadir (solo los .ics)
          add: '*.ics'
          # Fuerza el push para sobrescribir los antiguos
          push: 'true'
